# 一致hash算法
## 应用领域
> 数据分布式存储方面
+ 缓存（redis） 分布式数据库 分库分表 搜索引擎（es） Hadoop

## 分布式解决的问题
+ 高并发
+ 海量数据
> 单台机器无法抵抗数据量的问题，需要多台机器存储

那我们怎么知道数据在存放在哪个节点上？
## 方法1
hash求余 hash(key)%节点数量  
这种方式的缺点：不好扩展，因为如果想要新添加节点需要重新计算hash

如果将节点从3扩展为4，命中率就只有25%，未命中的有75%，原因如下：
1，2，3，4，5，6，7，8，9，10，11，12 这些数据有3个落在同一台机器上面
原先 
	节点1 1，4，7，10
	节点2 2，5，8，11
	节点3 3，6，9，12
现在
	节点1 1，5，9
	节点2 2，6，10
	节点3 3，7，11
	节点4 4，8，12
是不是，12个数里只有3个数命中了

## 数据预热也是一种方案，但是老火
## 方法2 一致hash
1 hash值是一个非负的整数，可以把一个值范围做成一个圆环
2 对集群的某个属性（节点名）求hash值，然后放到环上
3 对数据key求hash值，也放到环上，按照顺时针方向找到离他最近的节点放到它上面
4 新加入的节点，对后面节点的数据有影响

问题？
1 数据能够均衡分布么？
2 加一个节点能均衡的解决集群的其他节点的压力么？

解决思路：
1 我么可以把在环上的物理节点抽象出多个虚拟节点，每个物理节点的虚拟节点在环上均衡分布。
2 数据来了之后，先找虚拟节点，看他的物理节点是谁？就加入到那个物理节点上去。
3 虚拟节点越多，越均衡。

总结：
1 一致性是指什么？
	新加节点对已有节点的影响保持一致性
	最终是加了虚拟节点的


